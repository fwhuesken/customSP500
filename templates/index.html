<!DOCTYPE html>
<html>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style></style>

    <body>      
        <h1>Build your custom S&P 500</h1>



          <label>Sectors</label>
          <select id="sector" class="form-control" onchange="filterSector()">
            <option value="all-sectors">All sectors</option>
            <option>Industrials</option>
            <option>Health Care</option>
            <option>Information Technology</option>
            <option>Communication Services</option>
            <option>Consumer Staples</option>
            <option>Consumer Discretionary</option>
            <option>Utilities</option>
            <option>Financials</option>
            <option>Materials</option>
            <option>Real Estate</option>
            <option>Energy</option>
          </select>
          <p></p>
          <label>Search for name</label>
        <input class="form-control" type="text" id="search" onkeyup="searchName()">

        <h3 id="positionCount"></h3>
        <span id="val"></span>


        <button id="selectAll">Select all</button>

        <button id="removeAll">Remove  all from selection</button>

        <button id="toJSON">Selection to JSON</button>

        <button id="weightSelection">Go to weighting</button>



        <table id="portfolio" class="table table-hover table-condensed">
            <thead>
              <tr>
                  <th>Symbol</th>
                  <th>Name</th>
                  <th>Sector</th>
                  <th>Weight in %</th>
                  <th>Include in selection</th>
    <!--              <th>Share in selection</th>   -->
              </tr>
            </thead>  
            <tbody>
            <tr>
                {% for row in rows %}
            <tr>
               <td>{{row["symbol"]}}</td>
               <td>{{row["name"]}}</td>
               <td>{{row["sector"]}}</td>
               <td>{{row["weight"]}}</td>
               <td><input type="checkbox" class="myCheckbox" id="include" value="include" checked></td>
    <!--         <td><div class="form-group">
                    <div class="input-group mb-3">
                      <input type="number" class="form-control" aria-label="">
                      <div class="input-group-append">
                        <span class="input-group-text">%</span>
                      </div>
                    </div>
                  </div> -->
            </tr>
         {% endfor %}
          </tbody>
        </table>
    </body>
  <script>
      selectAllButton = document.getElementById("selectAll");
      selectAllButton.addEventListener("click", async function () {
        selectAll();
        await countPosition();
      })

      removeAllButton = document.getElementById("removeAll");
      removeAllButton.addEventListener("click", function () {
        deSelect();
      })

      toJSONButton = document.getElementById("toJSON");

      weightSelectionButton = document.getElementById("weightSelection");
      weightSelectionButton.addEventListener("click", function () {
        weighting();
      })
      

      function searchName() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("search");
        filter = input.value.toUpperCase();
        table = document.getElementById("portfolio");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[1];
          if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }

      
      function filterSector() {
          var input, filter, table, tr, td, i, txtValue;
          input = document.getElementById("sector");
          filter = input.value;
          table = document.getElementById("portfolio");
          tr = table.getElementsByTagName("tr");
          console.log(filter)

          // Loop through all table rows, and hide those who don't match the search query
        
              for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[2];
                if (td) {
                  txtValue = td.innerText;
                  if (input.value == "all-sectors") {
                      tr[i].style.display = "";
                  }
                    else if (txtValue.indexOf(filter) > -1) {
                      tr[i].style.display = "";
                    } else {
                      tr[i].style.display = "none";
                    }
                }
              }
            }


      
      function selectAll(){  
              var ele=document.getElementsByTagName('input');  
              for(var i=0; i<ele.length; i++){
                /* offsetParent checks if checkbox is currently visible */  
                  if(ele[i].type=='checkbox' && ele[i].offsetParent !== null)  
                      ele[i].checked=true;  
              }  
          }  

       function deSelect(){  
                var ele=document.getElementsByTagName('input'); 
                for(var i=0; i<ele.length; i++){  
                    if(ele[i].type=='checkbox' && ele[i].offsetParent !== null)  
                        ele[i].checked=false;   
                }  
            }          
      

const checkboxes = document.querySelectorAll(".myCheckbox");
const label = document.getElementById("positionCount");

const countPosition = checkboxes.forEach((checkbox) => {
  checkbox.addEventListener("change", () => {
    let total = 0;

    for (let i = 0; i < checkboxes.length; i++) {
      const currentCheckbox = checkboxes[i];
      if (currentCheckbox.checked) {
        total += 1;
      }
    }

    label.innerHTML = total;
  });
});
    </script>
</html>