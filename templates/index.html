<!DOCTYPE html>
<html>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>

    </style>

    <body>      
        <form action="/" method="post">
          <label>Index</label>
          <select name="index" id="index" class="form-control" onchange="baselineIndex()">
            
            <option value="fractionable">All fractionable equities</option>
            <option value="sp500">S&P 500</option>
            <option value="nasdaq100">NASDAQ 100</option>

            <input id=submitIndex type="submit" value="Submit"/>
          </select>
        </form>
<p></p>

                
          <label>Sectors</label>
          <select id="sector" class="form-control" onchange="filterSector()">
            <option value="all-sectors">All sectors</option>
            <option>Industrials</option>
            <option>Health Care</option>
            <option>Information Technology</option>
            <option>Communication Services</option>
            <option>Consumer Staples</option>
            <option>Consumer Discretionary</option>
            <option>Utilities</option>
            <option>Financials</option>
            <option>Materials</option>
            <option>Real Estate</option>
            <option>Energy</option>
          </select>
          <p></p>
          <label>Search for name</label>
        <input class="form-control" type="text" id="search" onkeyup="searchName()">

        

 <p></p>
  <p></p>
   <p></p>
        <h3 id="baselineIndex"></h3>

        <h3 id="positionCount"></h3>

        <button id="selectAll">Select all</button>

        <button id="removeAll">Remove  all from selection</button>

        <button id="toJSON">Selection to JSON</button>



        <table id="portfolio" class="table table-hover table-condensed">
            <thead>
              <tr>
                  <th>Symbol</th>
                  <th>Name</th>
                  <th>Sector</th>
                  <th>Include in selection</th>
    <!--              <th>Share in selection</th>   -->
              </tr>
            </thead>  
            <tbody>
            <tr>
                {% for row in rows %}
            <tr>
               <td>{{row["symbol"]}}</td>
               <td>{{row["name"]}}</td>
               <td>{{row["sector"]}}</td>
               <td><input type="checkbox" class="myCheckbox" id="include" value="include" checked></td>
    <!--         <td><div class="form-group">
                    <div class="input-group mb-3">
                      <input type="number" class="form-control" aria-label="">
                      <div class="input-group-append">
                        <span class="input-group-text">%</span>
                      </div>
                    </div>
                  </div> -->
            </tr>
         {% endfor %}
          </tbody>
        </table>
    </body>
  <script>
      selectAllButton = document.getElementById("selectAll");
      selectAllButton.addEventListener("click", async function () {
        selectAll();
        await countPosition();
      })

      removeAllButton = document.getElementById("removeAll");
      removeAllButton.addEventListener("click", function () {
        deSelect();
      })

      toJSONButton = document.getElementById("toJSON");

      function searchName() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("search");
        filter = input.value.toUpperCase();
        table = document.getElementById("portfolio");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[1];
          if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }

      
      function filterSector() {
          var input, filter, table, tr, td, i, txtValue;
          input = document.getElementById("sector");
          filter = input.value;
          table = document.getElementById("portfolio");
          tr = table.getElementsByTagName("tr");
          console.log(filter)

          // Loop through all table rows, and hide those who don't match the search query
        
              for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[2];
                if (td) {
                  txtValue = td.innerText;
                  if (input.value == "all-sectors") {
                      tr[i].style.display = "";
                  }
                    else if (txtValue.indexOf(filter) > -1) {
                      tr[i].style.display = "";
                    } else {
                      tr[i].style.display = "none";
                    }
                }
              }
            }

      function baselineIndex() {
        let e = document.getElementById("index");
        let value = e.options[e.selectedIndex].text;
        let text =  document.getElementById('baselineIndex');
        text.innerHTML = value;
      }
/*
      function countPositions () {
        let table = document.getElementById("portfolio");
        let rowCount = table.tBodies[0].rows.length;
        let positionCount = document.getElementById("positionCount")
        positionCount.innerHTML = rowCount
      }
      */
      
      function selectAll(){  
              var ele=document.getElementsByTagName('input');  
              for(var i=0; i<ele.length; i++){  
                  if(ele[i].type=='checkbox')  
                      ele[i].checked=true;  
              }  
          }  

       function deSelect(){  
                var ele=document.getElementsByTagName('input'); 
                for(var i=0; i<ele.length; i++){  
                    if(ele[i].type=='checkbox')  
                        ele[i].checked=false;   
                }  
            }          
      table = document.getElementById(portfolio)
      function tableToJson(table) {
        let data = [];

        // first row needs to be headers
        let headers = [];
        for (var i=0; i<table.rows[0].cells.length; i++) {
            headers[i] = table.rows[0].cells[i].innerHTML.toLowerCase().replace(/ /gi,'');
        }

        // go through cells
        for (let i=1; i<table.rows.length; i++) {

            let tableRow = table.rows[i];
            let rowData = {};

            for (let j=0; j<tableRow.cells.length; j++) {

                rowData[ headers[j] ] = tableRow.cells[j].innerHTML;

            }

            data.push(rowData);
        }       
         console.log(data);
        return data;
       
    }
  
/*    
alert(document.querySelectorAll('input[type="checkbox"]:checked').length);
*/

const checkboxes = document.querySelectorAll(".myCheckbox");
const label = document.getElementById("positionCount");

const countPosition = checkboxes.forEach((checkbox) => {
  checkbox.addEventListener("change", () => {
    let total = 0;

    for (let i = 0; i < checkboxes.length; i++) {
      const currentCheckbox = checkboxes[i];
      if (currentCheckbox.checked) {
        total += 1;
      }
    }

    label.innerHTML = total;
  });
});
    </script>
</html>